<?php

/**
 * Pivlu - Open source CMS (Content Management System).
 * Pivlu comes with the complete suite of tools that any business, team, or website owner needs.
 * https://pivlu.com
 *
 * Copyright (c) Chimilevschi Iosif-Gabriel
 * LICENSE:
 * Permissions of this strongest copyleft license are conditioned on making available complete source code 
 * of licensed works and modifications, which include larger works using a licensed work, under the same license. 
 * Copyright and license notices must be preserved. Contributors provide an express grant of patent rights. 
 * When a modified version is used to provide a service over a network, the complete source code of the modified version must be made available.
 *    
 * @copyright   Copyright (c) Chimilevschi Iosif-Gabriel
 * @license     https://opensource.org/license/agpl-v3  AGPL-3.0 License.
 * @author      Chimilevschi Iosif-Gabriel <office@pivlu.com>
 * 
 *  DO NOT edit this file manually. All changes will be lost after software update. For custom changes, use templates ans plugins system.
 */

use Pivlu\Models\Config;
use Pivlu\Models\ConfigLang;
use Pivlu\Models\Language;
use Pivlu\Models\ThemeStyle;
use Pivlu\Models\ThemeButton;
use Pivlu\Models\Theme;
use Pivlu\Models\ThemeFooter;

// Website general settings
if (!function_exists('get_site_info')) {
	function get_site_info($show = null)
	{
		$active_language = Language::get_active_language();

		switch ($show) {
			case 'name':
				$result = $active_language->site_label ?? 'Pivlu site';
				break;

			case 'url':
				$result = route('home');
				break;
			case 'text_dir':
				$result = $active_language->dir ?? 'ltr';
				break;
			case 'lang':
				$result = $active_language->code ?? 'en';
				break;
			default:
				$result = null;
				break;
		}

		return $result;
	}
}


if (!function_exists('get_homepage_info')) {
	function get_homepage_info($show = null)
	{
		$active_language = Language::get_active_language();

		switch ($show) {
			case 'title':
				$result = $active_language->site_label ?? 'Pivlu site';
				break;

			case 'description':
				$result = $active_language->site_label ?? 'Pivlu site';
				break;
			default:
				$result = $active_language->site_label ?? 'Pivlu site';
				break;
		}

		return $result;
	}
}


if (!function_exists('theme_asset')) {
	function theme_asset($file = null)
	{
		$active_theme = Theme::where('is_active', 1)->first();

		return asset('vendor/' . $active_theme->vendor_name . '/' . $active_theme->theme_name) . '/' . $file;
	}
}


if (!function_exists('theme_meta')) {
	function theme_meta($name = null)
	{
		if (! $name) return null;

		switch ($name) {
			case 'locale':
				return Language::get_active_language()->code;
				break;

			case 'dir':
				return Language::get_active_language()->dir;
				break;

			case 'label':
				return Config::get_config('site_label') ?? 'Pivlu website';
				break;

			case 'author':
				return Config::get_config('site_author') ?? 'Pivlu.com';
				break;

			default:
				return null;
		}
	}
}



if (!function_exists('get_active_theme_view')) {
	function get_active_theme_view()
	{
		$active_theme = Theme::where('is_active', 1)->first();

		if ($active_theme != 'builder')
			return 'themes.' . $active_theme->vendor_name . '.' . $active_theme->theme_name . '.';
		else
			return 'web.builder.';
	}
}

if (!function_exists('get_active_theme')) {
	function get_active_theme()
	{
		$theme = Theme::where('is_active', 1)->first();

		if (! $theme) $theme = Theme::where('is_default', 1)->first();

		return $theme;
	}
}

if (!function_exists('get_default_style')) {
	function get_default_style()
	{
		$id = ThemeStyle::where('is_default', 1)->value('id');

		return 'style_' . $id;
	}
}


if (!function_exists('get_style')) {
	function get_style($style)
	{
		$id = ThemeStyle::where('style', $style)->value('id');

		return 'style_' . $id;
	}
}



// menu links
if (!function_exists('menu_links')) {
	function menu_links()
	{
		$active_theme = Theme::get_active_theme();
		if (! $active_theme) return [];

		$theme_menu_id = $active_theme->menu_id;

		$val = ConfigLang::where('lang_id', Language::get_active_language()->id)->where('name', 'menu_links_' . $theme_menu_id)->value('value');
		$menu_links = json_decode($val);

		return $menu_links ?? [];
	}
}


// Website footer
if (!function_exists('footer')) {
	function footer()
	{
		$active_theme = Theme::get_active_theme();
		if (! $active_theme) return [];

		$footer = ThemeFooter::find($active_theme->footer_id ?? null);
		
		if (! $footer) $footer = ThemeFooter::where('is_default', 1)->first();

		return $footer;
	}
}

if (!function_exists('button')) {
	function button($id)
	{
		if (!$id) return null;
		$button = ThemeButton::find($id);
		return $button;
	}
}
