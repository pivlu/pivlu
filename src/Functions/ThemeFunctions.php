<?php

/**
 * Pivlu - Open source CMS (Content Management System).
 * Pivlu comes with the complete suite of tools that any business, team, or website owner needs.
 * https://pivlu.com
 *
 * Copyright (c) Chimilevschi Iosif-Gabriel
 * LICENSE:
 * Permissions of this strongest copyleft license are conditioned on making available complete source code 
 * of licensed works and modifications, which include larger works using a licensed work, under the same license. 
 * Copyright and license notices must be preserved. Contributors provide an express grant of patent rights. 
 * When a modified version is used to provide a service over a network, the complete source code of the modified version must be made available.
 *    
 * @copyright   Copyright (c) Chimilevschi Iosif-Gabriel
 * @license     https://opensource.org/license/agpl-v3  AGPL-3.0 License.
 * @author      Chimilevschi Iosif-Gabriel <office@pivlu.com>
 * 
 *  DO NOT edit this file manually. All changes will be lost after software update. For custom changes, use templates ans plugins system.
 */

namespace Pivlu\Functions;

use Pivlu\Models\Post;
use Pivlu\Models\Theme;
use Pivlu\Models\Language;
use Pivlu\Models\ThemeMenuItem;
use Pivlu\Models\ThemeButton;
use Pivlu\Models\BlockStyle;
use Pivlu\Models\ThemeConfig;
use Pivlu\Models\ThemeMenuContent;
use Pivlu\Models\ConfigLang;
use Pivlu\Models\PostContent;

class ThemeFunctions
{

    public static function get_active_theme()
    {
        if ($_GET['preview_theme'] ?? null) {
            $theme_code = preg_replace('/[^-a-zA-Z0-9_]/', '', $_GET['preview_theme']);
            $theme = Theme::where('code', $theme_code)->first();
        } else
            $theme = Theme::where('is_active', 1)->first();

        if (! $theme) $theme = Theme::where('is_active', 1)->first();

        return $theme;
    }



    public static function get_active_theme_view()
    {

        return (self::get_active_theme()->views_hint ?? 'pivlu') . '::';
    }

    public static function font_sizes()
    {
        $array[0] = (object)array('name' => '75%', 'value' => '0.75rem');
        $array[1] = (object)array('name' => '80%', 'value' => '0.8rem');
        $array[2] = (object)array('name' => '85%', 'value' => '0.85rem');
        $array[3] = (object)array('name' => '90%', 'value' => '0.9rem');
        $array[4] = (object)array('name' => '95%', 'value' => '0.95rem');
        $array[5] = (object)array('name' => '100%', 'value' => '1rem'); // root value
        $array[6] = (object)array('name' => '105%', 'value' => '1.05rem');
        $array[7] = (object)array('name' => '110%', 'value' => '1.1rem');
        $array[8] = (object)array('name' => '120%', 'value' => '1.2rem');
        $array[9] = (object)array('name' => '130%', 'value' => '1.3rem');
        $array[10] = (object)array('name' => '140%', 'value' => '1.4rem');
        $array[11] = (object)array('name' => '150%', 'value' => '1.5rem');
        $array[12] = (object)array('name' => '160%', 'value' => '1.6rem');
        $array[13] = (object)array('name' => '175%', 'value' => '1.75rem');
        $array[14] = (object)array('name' => '200%', 'value' => '2rem');
        $array[15] = (object)array('name' => '225%', 'value' => '2.25rem');
        $array[16] = (object)array('name' => '250%', 'value' => '2.5rem');
        $array[17] = (object)array('name' => '275%', 'value' => '2.75rem');
        $array[18] = (object)array('name' => '300%', 'value' => '3rem');
        $array[19] = (object)array('name' => '350%', 'value' => '3.5rem');
        $array[20] = (object)array('name' => '400%', 'value' => '4rem');
        $array[21] = (object)array('name' => '450%', 'value' => '4.5rem');
        $array[22] = (object)array('name' => '500%', 'value' => '5rem');
        $array[23] = (object)array('name' => '600%', 'value' => '6rem');
        $array[24] = (object)array('name' => '800%', 'value' => '8rem');
        $array[25] = (object)array('name' => '1000%', 'value' => '10rem');

        return (object)$array;
    }


    public static function fonts()
    {
        $array[0] = (object)array('value' => "'Open Sans', sans-serif", 'name' => 'Open Sans', 'weight' => '400;700', 'import' => 'Open+Sans:wght@400;700');
        $array[1] = (object)array('value' =>  "'Alegreya', serif", 'name' => 'Alegreya', 'weight' => '400;700', 'import' => 'Alegreya:wght@400;700');
        $array[2] = (object)array('value' =>  "'Alfa Slab One', cursive", 'name' => 'Alfa Slab One', 'weight' => '400', 'import' => 'Alfa+Slab+One:wght@400');
        $array[3] = (object)array('value' => "'Alegreya Sans', sans-serif", 'name' => 'Alegreya Sans', 'weight' => '400;700', 'import' => 'Alegreya+Sans:wght@400;700');
        $array[4] = (object)array('value' => "'Anton', sans-serif", 'name' => 'Anton', 'weight' => '400', 'import' => 'Anton:wght@400');
        $array[5] = (object)array('value' => "'Architects Daughter', cursive", 'name' => 'Architects Daughter', 'weight' => '400', 'import' => 'Architects+Daughter:wght@400');
        $array[6] = (object)array('value' => "'Archivo Black', sans-serif", 'name' => 'Archivo Black', 'weight' => '400', 'import' => 'Archivo+Black:wght@400');
        $array[7] = (object)array('value' => "'Arima Madurai', cursive", 'name' => 'Arima Madurai', 'weight' => '400;700', 'import' => 'Arima+Madurai:wght@400;700');
        $array[8] = (object)array('value' => "'Arvo', serif", 'name' => 'Arvo', 'weight' => '400;700', 'import' => 'Arvo:wght@400;700');
        $array[9] = (object)array('value' => "'Bitter', serif", 'name' => 'Bitter', 'weight' => '400;700', 'import' => 'Bitter:wght@400;700');
        $array[10] = (object)array('value' => "'Courgette', cursive", 'name' => 'Courgette', 'weight' => '400', 'import' => 'Courgette:wght@400');
        $array[11] = (object)array('value' => "'Courier Prime', monospace", 'name' => 'Courier Prime', 'weight' => '400;700', 'import' => 'Courier+Prime:wght@400;700');
        $array[12] = (object)array('value' => "'Crete Round', serif", 'name' => 'Crete Round', 'weight' => '400', 'import' => 'Crete+Round:wght@400');
        $array[13] = (object)array('value' => "'Dancing Script', cursive", 'name' => 'Dancing Script', 'weight' => '400;700', 'import' => 'Dancing+Script:wght@400;700');
        $array[14] = (object)array('value' => "'Exo', sans-serif", 'name' => 'Exo', 'weight' => '400;700', 'import' => 'Exo:wght@400;700');
        $array[15] = (object)array('value' => "'Fredoka', sans-serif", 'name' => 'Fredoka', 'weight' => '400;700', 'import' => 'Fredoka:wght@400;700');
        $array[16] = (object)array('value' => "'Inter', sans-serif", 'name' => 'Inter', 'weight' => '400;700', 'import' => 'Inter:wght@400;700');
        $array[17] = (object)array('value' => "'Krub', sans-serif", 'name' => 'Krub', 'weight' => '400;700', 'import' => 'Krub:wght@400;700');
        $array[18] = (object)array('value' => "'Lato', sans-serif", 'name' => 'Lato', 'weight' => '400;700', 'import' => 'Lato:wght@400;700');
        $array[19] = (object)array('value' => "'Libre Baskerville', serif", 'name' => 'Libre Baskerville', 'weight' => '400;700', 'import' => 'Libre+Baskerville:wght@400;700');
        $array[20] = (object)array('value' => "'Lora', serif", 'name' => 'Lora', 'weight' => '400;700', 'import' => 'Lora:wght@400;700');
        $array[21] = (object)array('value' => "'Merriweather', serif", 'name' => 'Merriweather', 'weight' => '400;700', 'import' => 'Merriweather:wght@400;700');
        $array[22] = (object)array('value' => "'Montserrat', sans-serif", 'name' => 'Montserrat', 'weight' => '400;700', 'import' => 'Montserrat:wght@400;700');
        $array[23] = (object)array('value' => "'Nanum Gothic', sans-serif", 'name' => 'Nanum Gothic', 'weight' => '400;700', 'import' => 'Nanum+Gothic:wght@400;700');
        $array[24] = (object)array('value' => "'Noto Sans', sans-serif", 'name' => 'Noto Sans', 'weight' => '400;700', 'import' => 'Noto+Sans:wght@400;700');
        $array[25] = (object)array('value' => "'Nunito', sans-serif", 'name' => 'Nunito', 'weight' => '400;700', 'import' => 'Nunito:wght@400;700');
        $array[26] = (object)array('value' => "'Open Sans', sans-serif", 'name' => 'Open Sans', 'weight' => '400;700', 'import' => 'Open+Sans:wght@400;700');
        $array[27] = (object)array('value' => "'Oswald', sans-serif", 'name' => 'Oswald', 'weight' => '400;700', 'import' => 'Oswald:wght@400;700');
        $array[28] = (object)array('value' => "'Pacifico', cursive", 'name' => 'Pacifico', 'weight' => '400', 'import' => 'Pacifico:wght@400');
        $array[29] = (object)array('value' => "'Playfair Display', serif", 'name' => 'Playfair Display', 'weight' => '400;700', 'import' => 'Playfair+Display:wght@400;700');
        $array[30] = (object)array('value' => "'Poppins', sans-serif", 'name' => 'Poppins', 'weight' => '400;700', 'import' => 'Poppins:wght@400;700');
        $array[31] = (object)array('value' => "'Prata', serif", 'name' => 'Prata', 'weight' => '400', 'import' => 'Prata:wght@400');
        $array[32] = (object)array('value' => "'Quicksand', sans-serif", 'name' => 'Quicksand', 'weight' => '400;700', 'import' => 'Quicksand:wght@400;700');
        $array[33] = (object)array('value' => "'Raleway', sans-serif", 'name' => 'Raleway', 'weight' => '400;700', 'import' => 'Raleway:wght@400;700');
        $array[34] = (object)array('value' => "'Roboto', sans-serif", 'name' => 'Roboto', 'weight' => '400;700', 'import' => 'Roboto:wght@400;700');
        $array[35] = (object)array('value' => "'Roboto Mono', monospace", 'name' => 'Roboto Mono', 'weight' => '400;700', 'import' => 'Roboto+Mono:wght@400;700');
        $array[36] = (object)array('value' => "'Roboto Slab', sans-serif", 'name' => 'Roboto Slab', 'weight' => '400;700', 'import' => 'Roboto+Slab:wght@400;700');
        $array[37] = (object)array('value' => "'Sen', sans-serif", 'name' => 'Sen', 'weight' => '400;700', 'import' => 'Sen:wght@400;700');
        $array[38] = (object)array('value' => "'Source Code Pro', monospace", 'name' => 'Source Code Pro', 'weight' => '400;700', 'import' => 'Source+Code+Pro:wght@400;700');
        $array[39] = (object)array('value' =>  "'Source Sans Pro', sans-serif", 'name' => 'Source Sans Pro', 'weight' => '400;700', 'import' => 'Source+Sans+Pro:wght@400;700');
        $array[40] = (object)array('value' =>  "'Source Serif Pro', sans-serif", 'name' => 'Source Serif Pro', 'weight' => '400;700', 'import' => 'Source+Serif+Pro:wght@400;700');
        $array[41] = (object)array('value' => "'Ubuntu', sans-serif", 'name' => 'Ubuntu', 'weight' => '400;700', 'import' => 'Ubuntu:wght@400;700');
        $array[42] = (object)array('value' => "'Urbanist', sans-serif", 'name' => 'Urbanist', 'weight' => '400;700', 'import' => 'Urbanist:wght@400;700');
        $array[43] = (object)array('value' => "'Work Sans', sans-serif", 'name' => 'Work Sans', 'weight' => '400;700', 'import' => 'Work+Sans:wght@400;700');

        return (object)$array;
    }



    public static function generate_styles_css()
    {
        $css_file = fopen('custom/styles.css', "w");

        $styles = BlockStyle::get();
        $buttons = ThemeButton::get();
        $fonts_array = array();

        // 1. IMPORT FONTS
        foreach ($styles as $style) {

            $data = json_decode($style->data);

            $font_family = $data->font_family ?? config('pivlu.defaults.font_family');
            $font_weights = $data->font_family_weights ?? '400';
            $arr1 = explode(',', $font_family);
            $font_family_import = str_replace('\'', '', $arr1[0]);
            $font_family_import = str_replace(' ', '+', $font_family_import);
            $font_family_import =  $font_family_import . ":wght@" . $font_weights;

            //echo $font_family_import . "<br>";
            array_push($fonts_array, $font_family_import);

            $fonts_array = array_unique($fonts_array);

            $fonts_list = '';
            foreach ($fonts_array as $font_import) {
                $fonts_list = $fonts_list . '&family=' . $font_import;
            }

            if (substr($fonts_list, 0, 8) == '&family=') $fonts_list = substr($fonts_list, 8);
            $import_url = 'https://fonts.googleapis.com/css2?family=' . $fonts_list . '&display=swap';
        }

        if (count($styles) > 0) {
            $write_import = "@import url('" . $import_url . "');\n ";
            fwrite($css_file, $write_import);
        }

        foreach ($styles as $style) {

            $data = json_decode($style->data);


            // FONTS AND COLORS
            $bg_color = $data->bg_color ?? 'white';
            $use_custom_bg = $data->use_custom_bg ?? 0;
            $font_color = $data->text_color ?? config('pivlu.defaults.font_color');
            $text_font_weight = $data->text_font_weight ?? 'normal';
            $text_font_size = $data->text_size ?? '1em';
            $title_size = $data->title_size ?? '2.2em';
            $subtitle_size = $data->subtitle_size ?? '1.8em';
            $title_font_weight = $data->title_font_weight ?? 'normal';
            $subtitle_font_weight = $data->subtitle_font_weight ?? 'normal';
            $text_align = $data->text_align ?? 'left';
            $caption_color = $data->caption_color ?? 'grey';
            $caption_size = $data->caption_size ?? '0.95em';
            $caption_style = $data->caption_style ?? 'normal';

            if ($use_custom_bg == 1)
                $write = ".style_$style->id { background-color: $bg_color; } ";

            $write = ".style_$style->id { color: $font_color; font-weight: $text_font_weight; font-size: $text_font_size; text-align: $text_align;  } ";
            $write .= ".style_$style->id .title {font-size: $title_size; font-weight: $title_font_weight; line-height:1.3 } ";
            $write .= ".style_$style->id .subtitle { font-size: $subtitle_size; font-weight: $subtitle_font_weight; line-height:1.3 } ";
            $write .= ".style_$style->id .caption { font-style: $caption_style; color: $caption_color; font-size: $caption_size; } ";
            fwrite($css_file, $write);

            if ($data->font_family ?? null) {
                $font_family = $data->font_family;
                $write = ".style_$style->id { font-family: $font_family; } ";
                fwrite($css_file, $write);
            }

            if ($data->bg_color ?? null) {
                $bg_color = $data->bg_color ?? config('pivlu.defaults.bg_color');
                $write = ".style_$style->id { background-color: $bg_color; } ";
                fwrite($css_file, $write);
            }

            // LINKS            
            $link_color = $data->link_color ?? config('pivlu.defaults.link_color');
            $link_color_hover = $data->link_hover_color ?? config('pivlu.defaults.link_color_hover');
            $link_underline_offset = $data->link_underline_offset ?? 'auto';
            $link_underline_thickness = $data->link_underline_thickness ?? 'auto';
            $link_underline_color = $data->link_underline_color ?? 'black';
            $link_underline_color_hover = $data->link_underline_color_hover ?? 'black';

            $link_decoration = $data->link_decoration ?? config('pivlu.defaults.link_decoration');
            $link_hover_decoration = $data->link_hover_decoration ?? config('pivlu.defaults.link_hover_decoration');
            $link_underline_offset = $data->link_underline_offset ?? config('pivlu.defaults.link_hover_decoration');

            $link_font_weight = $data->link_font_weight ?? 'normal';

            $write = ".style_$style->id a, a .style_$style->id .nav-link, .nav-link { color: $link_color; text-decoration: $link_decoration; -webkit-text-decoration-color: $link_underline_color; text-decoration-color: $link_underline_color; font-weight: $link_font_weight; text-decoration-thickness: $link_underline_thickness; 
                text-underline-offset: $link_underline_offset; } ";

            if (($data->link_decoration ?? null) == 'double') $write .= ".style_$style->id a { text-decoration-line: underline; text-decoration-style: double; } ";
            if (($data->link_decoration ?? null)  == 'dashed') $write .= ".style_$style->id a { text-decoration-line: underline; text-decoration-style: dashed; } ";
            if (($data->link_decoration ?? null)  == 'dotted') $write .= ".style_$style->id a { text-decoration-line: underline; text-decoration-style: dotted; } ";
            if (($data->link_decoration ?? null)  == 'wavy') $write .= ".style_$style->id a { text-decoration-line: underline; text-decoration-style: wavy; } ";

            $write .= ".style_$style->id a:hover, .style_$style->id a:focus { color: $link_color_hover; 
                text-decoration: $link_hover_decoration; 
                -webkit-text-decoration-color: $link_underline_color; 
                text-decoration-color: $link_underline_color_hover;                
                text-decoration-thickness: $link_underline_thickness;
                text-underline-offset: $link_underline_offset; } ";

            if (($data->link_hover_decoration ?? null) == 'double') $write .= ".style_$style->id a:hover { text-decoration-line: underline; text-decoration-style: double; } ";
            if (($data->link_hover_decoration ?? null) == 'dashed') $write .= ".style_$style->id a:hover { text-decoration-line: underline; text-decoration-style: dashed; } ";
            if (($data->link_hover_decoration ?? null) == 'dotted') $write .= ".style_$style->id a:hover { text-decoration-line: underline; text-decoration-style: dotted; } ";
            if (($data->link_hover_decoration ?? null) == 'wavy') $write .= ".style_$style->id a:hover { text-decoration-line: underline; text-decoration-style: wavy; } ";

            fwrite($css_file, $write);

            // BUTTONS
            foreach ($buttons as $button) {
                $button_data = json_decode(($button->data));

                $bg_color = $button_data->bg_color ?? config('pivlu.defaults.button_bg_color');
                $font_color = $button_data->font_color ?? config('pivlu.defaults.button_font_color');
                $font_weight = $button_data->font_weight ?? 'normal';
                $rounded = $button_data->rounded ?? 0;
                $border_color = $button_data->border_color ?? config('pivlu.defaults.button_border_color');
                $bg_color_hover = $button_data->bg_color_hover ?? config('pivlu.defaults.button_bg_color_hover');
                $font_color_hover = $button_data->font_color_hover ?? config('pivlu.defaults.button_font_color_hover');
                $border_color_hover = $button_data->border_color_hover ?? config('pivlu.defaults.button_border_color_hover');

                $write = ".btn_$button->id, a .btn_$button->id  {
                    background-color: $bg_color; 
                    color: $font_color;
                    border-color: $border_color;
                    font-weight: $font_weight;
                    text-decoration: none;
                    border-radius: $rounded;
                } ";

                $write .= ".btn_$button->id:hover, .btn_$button->id:focus {
                background-color: $bg_color_hover ;
                color: $font_color_hover;
                border-color: $border_color_hover;
                font-weight: $font_weight;
                text-decoration: none; } ";

                $write .= ".btn_$button->id a, a .btn_$button->id {
                color: $font_color ;       
                font-weight: $font_weight;         
                text-decoration: none; }";

                $write .= ".btn_$button->id a:hover, a:hover .btn_$button->id {
                color: $font_color_hover ;
                text-decoration: none; }";

                fwrite($css_file, $write);
            }

            fwrite($css_file, $write);
        }


        // END. Close the file
        fclose($css_file);
        return;
    }



    public static function generate_theme_css($theme_code)
    {
        $css_file = fopen('custom/themes/' . $theme_code . '.css', "w");

        $theme = Theme::where('code', $theme_code)->first();
        if (! $theme) return;

        $theme_config = ThemeConfig::config($theme->id);

        // 1. FONT FAMILY
        $font_family_data = $theme_config->default_font_family_data ?? config('pivlu.defaults.font_family_data');
        $font_array = explode('|', $font_family_data);
        $font_family_name = $font_array[0];
        $font_family_import = $font_array[1];

        $import_url = 'https://fonts.googleapis.com/css2?family=' . $font_family_import . '&display=swap';
        $write_import = "@import url('" . $import_url . "');\n ";
        fwrite($css_file, $write_import);

        // 2. FONTS AND COLORS
        $font_color = $theme_config->default_text_color ?? config('pivlu.defaults.font_color');
        $font_size = $theme_config->default_font_size ?? config('pivlu.defaults.font_size');

        $h1_size = $theme_config->default_h1_size ?? config('pivlu.defaults.h1_size');
        $h2_size = $theme_config->default_h2_size ?? config('pivlu.defaults.h2_size');
        $h3_size = $theme_config->default_h3_size ?? config('pivlu.defaults.h3_size');

        $h1_weight = $theme_config->default_h1_weight ?? 'normal';
        $h2_weight = $theme_config->default_h2_weight ?? 'normal';
        $h3_weight = $theme_config->default_h3_weight ?? 'normal';

        $caption_size = $theme_config->default_caption_size ?? config('pivlu.defaults.caption_size');
        $caption_color = $theme_config->default_caption_color ?? 'grey';
        $caption_font_style = $theme_config->default_caption_font_style ?? 'normal';

        $bg_color = $theme_config->default_bg_color ?? config('pivlu.defaults.bg_color');

        $write = "html, body { font-family: $font_family_name; color: $font_color; font-size: $font_size; background-color: $bg_color } ";

        $write .= "h1 {font-size: $h1_size; font-weight: $h1_weight  } ";
        $write .= "h2 {font-size: $h2_size; font-weight: $h2_weight  } ";
        $write .= "h3 {font-size: $h3_size; font-weight: $h3_weight  } ";

        $write .= ".title { font-size: $h1_size; font-weight: $h1_weight  } ";
        $write .= ".subtitle { font-size: $h2_size; font-weight: $h2_weight  } ";
        $write .= ".caption { font-style: $caption_font_style; color: $caption_color; font-size: $caption_size  } ";

        fwrite($css_file, $write);


        // 3. LINKS            
        $link_color = $theme_config->default_link_color ?? config('pivlu.defaults.link_color');
        $link_color_hover = $theme_config->default_link_hover_color ?? config('pivlu.defaults.link_color_hover');
        $link_underline_offset = $theme_config->default_link_underline_offset ?? 'auto';
        $link_underline_thickness = $theme_config->default_link_underline_thickness ?? 'auto';
        $link_color_underline = $theme_config->default_link_color_underline ?? config('pivlu.defaults.link_color_underline');
        $link_color_underline_hover = $theme_config->default_link_color_underline_hover ?? 'black';

        $link_decoration = $theme_config->default_link_decoration ?? config('pivlu.defaults.link_decoration');
        $link_hover_decoration = $theme_config->default_link_hover_decoration ?? config('pivlu.defaults.link_hover_decoration');
        $link_underline_offset = $theme_config->default_link_underline_offset ?? config('pivlu.defaults.link_hover_decoration');

        $write = "a { color: $link_color; text-decoration: $link_decoration; -webkit-text-decoration-color: $link_color_underline; text-decoration-color: $link_color_underline; text-decoration-thickness: $link_underline_thickness; 
                text-underline-offset: $link_underline_offset; } ";

        if (($theme_config->default_link_decoration ?? null) == 'double') $write .= "a { text-decoration-line: underline; text-decoration-style: double; } ";
        if (($theme_config->default_link_decoration ?? null) == 'dashed') $write .= "a { text-decoration-line: underline; text-decoration-style: dashed; } ";
        if (($theme_config->default_link_decoration ?? null) == 'dotted') $write .= "a { text-decoration-line: underline; text-decoration-style: dotted; } ";
        if (($theme_config->default_link_decoration ?? null) == 'wavy') $write .= "a { text-decoration-line: underline; text-decoration-style: wavy; } ";

        $write .= "a:hover { color: $link_color_hover; 
                text-decoration: $link_hover_decoration; 
                -webkit-text-decoration-color: $link_color_underline; 
                text-decoration-color: $link_color_underline_hover;                
                text-decoration-thickness: $link_underline_thickness;
                text-underline-offset: $link_underline_offset; } ";

        if (($theme_config->default_link_hover_decoration ?? null) == 'double') $write .= "a:hover { text-decoration-line: underline; text-decoration-style: double; } ";
        if (($theme_config->default_link_hover_decoration ?? null) == 'dashed') $write .= "a:hover { text-decoration-line: underline; text-decoration-style: dashed; } ";
        if (($theme_config->default_link_hover_decoration ?? null) == 'dotted') $write .= "a:hover { text-decoration-line: underline; text-decoration-style: dotted; } ";
        if (($theme_config->default_link_hover_decoration ?? null) == 'wavy') $write .= "a:hover { text-decoration-line: underline; text-decoration-style: wavy; } ";

        fwrite($css_file, $write);

        // END. Close the file
        fclose($css_file);
        return;
    }


    public static function generate_menu_links($menu_id)
    {
        $items = [];

        $default_lang_id = Language::get_default_language()->id;

        $langs = Language::get_languages();

        foreach ($langs as $lang) {

            $links = ThemeMenuItem::where('menu_id', $menu_id)->whereNull('parent_id')->orderBy('position')->get();

            $items = [];

            foreach ($links as $link) {

                $dropdown = [];

                $link_content = ThemeMenuContent::where(['menu_id' => $menu_id, 'item_id' => $link->id, 'lang_id' => $lang->id])->first();

                if ($link->type == 'home' || $link->type == 'page' || $link->type == 'post_type') {
                    $url = $link_content->url ?? '#';
                }

                if ($link->type == 'custom') {
                    $url = $link_content->custom_url ?? '#';
                    if (!(str_starts_with($url, 'http://') || str_starts_with($url, 'https://')))
                        $url = 'https://' . $url;                     
                }


                if ($link->type == 'dropdown') {
                    $url = '#';

                    $dropdown_links = ThemeMenuItem::where('menu_id', $menu_id)->where('parent_id', $link->id)->orderBy('position')->get();
                    foreach ($dropdown_links as $dropdown_link) {

                        $dropdown_link_content = ThemeMenuContent::where(['menu_id' => $menu_id, 'item_id' => $dropdown_link->id, 'lang_id' => $lang->id])->first();

                        if ($dropdown_link->type == 'home' || $dropdown_link->type == 'page' || $dropdown_link->type == 'post_type') {
                            $dropdown_url = $dropdown_link_content->url ?? '#';
                        }

                        if ($dropdown_link->type == 'custom') {
                            $dropdown_url = $dropdown_link_content->custom_url ?? '#';
                            if (!(str_starts_with($dropdown_url, 'http://') || str_starts_with($dropdown_url, 'https://')))
                                $dropdown_url = 'https://' . $dropdown_url;
                        }

                        $dropdown[] = array(
                            'label' => $dropdown_link_content->label ?? '#',
                            'description' => $dropdown_link_content->description ?? null,
                            'url' => $dropdown_url ?? null,
                            'new_tab' => $dropdown_link->new_tab,
                            'icon' => $dropdown_link->icon
                        );
                    }
                }


                $items[] = array(
                    'label' => $link_content->label ?? '#',
                    'description' => $link_content->description ?? null,
                    'url' => $url ?? '#',
                    'dropdown' => $dropdown,
                    'type' => $link->type,
                    'btn_id' => $link->btn_id,
                    'new_tab' => $link->new_tab,
                    'icon' => $link->icon,
                    'css_classes' => $link->css_classes
                );
            }

            ConfigLang::update_config($lang->id, 'menu_links_' . $menu_id, json_encode($items, JSON_UNESCAPED_UNICODE));
        }

        return null;
    }


    /*
    public static function generate_menu_links($menu_id)
    {
        $default_lang_id = Language::get_default_language()->id;

        $langs = Language::get_languages();

        foreach ($langs as $lang) {

            $links = ThemeMenuItem::where('menu_id', $menu_id)->whereNull('parent_id')->orderBy('position')->get();

            $items = [];

            foreach ($links as $link) {

                $dropdown = [];

                if ($link->type == 'home') {
                    if ($lang->id == $default_lang_id) $url = route('home');
                    else $url = route('locale.home', ['lang' => $lang->code]);
                }

                if ($link->type == 'page') {
                    $page = Post::where('id', $link->value)->first();
                    $page_content = PostContent::where('post_id', $link->value)->where('lang_id', $lang->id)->first();

                    if ($page->parent_id)
                        $parent_page_content = PostContent::where('post_id', $page->parent_id)->where('lang_id', $lang->id)->first();

                    if ($page_content) {

                        if ($lang->id == $default_lang_id) {
                            if ($page->parent_id)
                                $url = route('level2', ['slug1' => $parent_page_content->slug ?? null, 'slug2' => $page_content->slug ?? null]);
                            else
                                $url = route('level1', ['slug' => $page_content->slug ?? null]);
                        } else {
                            $lang = Language::where('id', $page_content->lang_id)->first();
                            if ($page->parent_id)
                                $url = route('locale.level2', ['lang' => $lang->code, 'slug1' => $parent_page_content->slug ?? null, 'slug2' => $page_content->slug ?? null]);
                            else
                                $url = route('locale.level1', ['lang' => $lang->code, 'slug' => $page_content->slug]);
                        }
                    } else $url = '#';
                }

                if ($link->type == 'custom')
                    $url = $link->value;

                if ($link->type == 'dropdown') {
                    $url = '#';

                    $dropdown_links = ThemeMenuItem::where('menu_id', $menu_id)->where('parent_id', $link->id)->orderBy('position')->get();
                    foreach ($dropdown_links as $dropdown_link) {

                        if ($dropdown_link->type == 'home') {
                            if ($lang->id == $default_lang_id) $dropdown_url = route('home');
                            else $dropdown_url = route('locale.home', ['lang' => $lang->code]);
                        }

                        if ($dropdown_link->type == 'page') {
                            $page = PostContent::where('post_id', $dropdown_link->value)->where('lang_id', $lang->id)->first();
                            if ($page->slug ?? null) {
                                if ($lang->id == $default_lang_id)
                                    $dropdown_url = route('level1', ['slug' => $page->slug ?? null]);
                                else {
                                    $lang = Language::where('id', $page->lang_id)->first();
                                    $dropdown_url = route('locale.level1', ['lang' => $lang->code, 'slug' => $page->slug]);
                                }
                            } else $dropdown_url = '#';
                        }

                        if ($dropdown_link->type == 'custom')
                            $dropdown_url = $dropdown_link->value;

                        $menu_content = ThemeMenuContent::where(['menu_id' => $menu_id, 'item_id' => $dropdown_link->id, 'lang_id' => $lang->id])->first();

                        $dropdown[] = array(
                            'label' => $menu_content->label ?? '#',
                            'description' => $menu_content->description ?? null,
                            'url' => $dropdown_url ?? null,
                            'new_tab' => $dropdown_link->new_tab,
                            'icon' => $dropdown_link->icon
                        );
                    }
                }


                $menu_content = ThemeMenuContent::where(['menu_id' => $menu_id, 'item_id' => $link->id, 'lang_id' => $lang->id])->first();

                $items[] = array(
                    'label' => $menu_content->label ?? '#',
                    'description' => $menu_content->description ?? null,
                    'url' => $url ?? '#',
                    'dropdown' => $dropdown,
                    'type' => $link->type,
                    'btn_id' => $link->btn_id,
                    'new_tab' => $link->new_tab,
                    'icon' => $link->icon,
                    'css_classes' => $link->css_classes
                );
            }

            ConfigLang::update_config($lang->id, 'menu_links_' . $menu_id, json_encode($items, JSON_UNESCAPED_UNICODE));
        }

        return null;
    }
        */
}
