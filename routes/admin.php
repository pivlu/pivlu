<?php

/**
 * Pivlu - Open source CMS (Content Management System).
 * Pivlu comes with the complete suite of tools that any business, team, or website owner needs.
 * https://pivlu.com
 *
 * Copyright (c) Chimilevschi Iosif-Gabriel
 * LICENSE:
 * Permissions of this strongest copyleft license are conditioned on making available complete source code 
 * of licensed works and modifications, which include larger works using a licensed work, under the same license. 
 * Copyright and license notices must be preserved. Contributors provide an express grant of patent rights. 
 * When a modified version is used to provide a service over a network, the complete source code of the modified version must be made available.
 *    
 * @copyright   Copyright (c) Chimilevschi Iosif-Gabriel
 * @license     https://opensource.org/license/agpl-v3  AGPL-3.0 License.
 * @author      Chimilevschi Iosif-Gabriel <office@pivlu.com>
 * 
 *  DO NOT edit this file manually. All changes will be lost after software update. For custom changes, use templates ans plugins system.
 */

declare(strict_types=1);

use Illuminate\Support\Facades\Route;

use Pivlu\Http\Controllers\Admin\AjaxController;
use Pivlu\Http\Controllers\Admin\AccountController;
use Pivlu\Http\Controllers\Admin\AccountInternalNoteController;
use Pivlu\Http\Controllers\Admin\AccountRoleController;
use Pivlu\Http\Controllers\Admin\AccountInvitationController;
use Pivlu\Http\Controllers\Admin\ConfigController;
use Pivlu\Http\Controllers\Admin\DashboardController;
use Pivlu\Http\Controllers\Admin\TrashController;

Route::get('account/admin', [DashboardController::class, 'index'])->name('admin');

Route::prefix('account/admin')->name('admin.')->group(function () {
    // Dashboard
    Route::get('dashboard', [DashboardController::class, 'index'])->name('dashboard');

    // Roles and permissions
    Route::resource('accounts/roles', AccountRoleController::class)->parameters(['roles' => 'role']);
    //Route::get('accounts/roles/{role}', [AccountRoleController::class, 'permissions'])->where('role', '[a-zA-Z0-9_]+')->name('roles.permissions');
    //Route::post('accounts/roles/{role}', [AccountController::class, 'update_permissions']);

    Route::get('accounts/invitations', [AccountInvitationController::class, 'index'])->name('accounts.invitations');
    Route::post('accounts/send-invitation', [AccountInvitationController::class, 'send'])->name('accounts.send_invitation');
    Route::post('accounts/resend-invitation', [AccountInvitationController::class, 'resend'])->name('accounts.resend_invitation');
    Route::delete('accounts/delete-invitation', [AccountInvitationController::class, 'destroy'])->name('accounts.delete_invitation');

    // Accounts
    Route::resource('accounts', AccountController::class)->parameters(['accounts' => 'id']);

    Route::get('account/{id}/block', [AccountController::class, 'block'])->where('id', '[0-9]+')->name('account.block');
    Route::post('account/{id}/action/{action}', [AccountController::class, 'action'])->where('id', '[0-9]+')->where('action', '[a-zA-Z0-9]+')->name('account.action');

    Route::get('account/{id}/reset-password', [AccountController::class, 'reset_password'])->where('id', '[0-9]+')->name('account.reset_password');
    Route::post('account/{id}/reset-password', [AccountController::class, 'reset_password_action'])->where('id', '[0-9]+');

    Route::resource('accounts.internal-notes', AccountInternalNoteController::class)->parameters(['accounts' => 'account_id', 'internal-notes' => 'note_id'])->shallow();

    //  admins only
    Route::middleware('logged_is_admin')->group(function () {
        // Config
        Route::get('config/{tab}', [ConfigController::class, 'index'])->name('config')->where(['tab' => '[a-zA-Z0-9_-]+']);
        Route::post('config', [ConfigController::class, 'update_config'])->name('config.update');
        Route::post('config-lang', [ConfigController::class, 'update_config_lang'])->where(['tab' => '[a-zA-Z0-9_-]+'])->name('config-lang.update');

        // Modules
        Route::get('modules', [ModuleController::class, 'index'])->name('modules');
        Route::post('modules', [ModuleController::class, 'update']);

        // Trash
        Route::get('trash', [TrashController::class, 'index'])->name('trash');
        Route::get('trash/empty/{module}', [TrashController::class, 'empty'])->name('trash.empty')->where('module', '[a-zA-Z0-9]+');
        Route::post('trash/multiple-action/{module}', [TrashController::class, 'multiple_action'])->name('trash.multiple_action')->where('module', '[a-zA-Z0-9]+');
        Route::get('trash/single-action/{module}/{id}', [TrashController::class, 'single_action'])->name('trash.single_action')->where('module', '[a-zA-Z0-9]+')->where('id', '[0-9]+');
        Route::get('trash/{module}', [TrashController::class, 'module'])->name('trash.module')->where('module', '[a-zA-Z0-9]+');
    });

    // Other routes
    Route::get('ajax/{source}', [AjaxController::class, 'index'])->name('ajax')->where('source', '[a-z0-9_-]+');
});
