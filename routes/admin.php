<?php

/**
 * Pivlu - Open source CMS (Content Management System).
 * Pivlu comes with the complete suite of tools that any business, team, or website owner needs.
 * https://pivlu.com
 *
 * Copyright (c) Chimilevschi Iosif-Gabriel
 * LICENSE:
 * Permissions of this strongest copyleft license are conditioned on making available complete source code 
 * of licensed works and modifications, which include larger works using a licensed work, under the same license. 
 * Copyright and license notices must be preserved. Contributors provide an express grant of patent rights. 
 * When a modified version is used to provide a service over a network, the complete source code of the modified version must be made available.
 *    
 * @copyright   Copyright (c) Chimilevschi Iosif-Gabriel
 * @license     https://opensource.org/license/agpl-v3  AGPL-3.0 License.
 * @author      Chimilevschi Iosif-Gabriel <office@pivlu.com>
 * 
 *  DO NOT edit this file manually. All changes will be lost after software update. For custom changes, use templates ans plugins system.
 */

declare(strict_types=1);

use Illuminate\Support\Facades\Route;

use App\Http\Controllers\Admin\AccountController;
use App\Http\Controllers\Admin\AccountInvitationController;
use App\Http\Controllers\Admin\AjaxController;
use App\Http\Controllers\Admin\BlockController;
use App\Http\Controllers\Admin\ConfigController;
use App\Http\Controllers\Admin\DashboardController;
use App\Http\Controllers\Admin\LangController;
use App\Http\Controllers\Admin\PostTypeController;
use App\Http\Controllers\Admin\PostTypeTaxonomiesController;
use App\Http\Controllers\Admin\PostController;
use App\Http\Controllers\Admin\PluginController;
use App\Http\Controllers\Admin\TaxonomyController;
use App\Http\Controllers\Admin\RecycleBinController;
use App\Http\Controllers\Admin\TemplateController;
use App\Http\Controllers\Admin\TemplateBuilderController;
use App\Http\Controllers\Admin\TemplateButtonController;
use App\Http\Controllers\Admin\TemplateFooterController;
use App\Http\Controllers\Admin\TemplateLayoutController;
use App\Http\Controllers\Admin\TemplateMenuController;
use App\Http\Controllers\Admin\TemplateStyleController;
use App\Http\Controllers\Admin\ThemeController;

use App\Http\Middleware\LoggedIsAdminMiddleware;

Route::get('account/admin', [DashboardController::class, 'dashboard'])->name('admin');

Route::prefix('account/admin')->name('admin.')->group(function () {
    // Dashboard
    Route::get('dashboard', [DashboardController::class, 'dashboard'])->name('dashboard');

    // Wizard
    Route::get('wizard', [DashboardController::class, 'wizard'])->name('wizard');

    // Accounts
    Route::get('accounts/deleted', [AccountController::class, 'deleted'])->name('accounts.deleted');
    Route::get('accounts/deleted/action/{action}/{id}', [AccountController::class, 'deleted_action'])->name('accounts.deleted.action')->where(['action' => '[a-z0-9_-]+'])->where('id', '[0-9]+');

    Route::get('accounts/invitations', [AccountInvitationController::class, 'index'])->name('accounts.invitations');
    Route::post('accounts/send-invitation', [AccountInvitationController::class, 'send'])->name('accounts.send_invitation');
    Route::post('accounts/resend-invitation', [AccountInvitationController::class, 'resend'])->name('accounts.resend_invitation');
    Route::delete('accounts/delete-invitation', [AccountInvitationController::class, 'destroy'])->name('accounts.delete_invitation');

    Route::get('accounts/permissions', [AccountController::class, 'permissions'])->name('accounts.permissions');
    Route::post('accounts/permissions', [AccountController::class, 'update_permissions']);

    Route::resource('accounts', AccountController::class)->parameters(['accounts' => 'id']);

    Route::get('account/{id}/internal-notes', [AccountController::class, 'internal_notes'])->where('id', '[0-9]+')->name('account.internal_notes');
    Route::post('account/{id}/internal-notes', [AccountController::class, 'store_internal_note'])->where('id', '[0-9]+');
    Route::delete('account/{id}/internal-notes', [AccountController::class, 'destroy_internal_note'])->where('id', '[0-9]+');

    Route::get('account/{id}/block', [AccountController::class, 'block'])->where('id', '[0-9]+')->name('account.block');
    Route::post('account/{id}/action/{action}', [AccountController::class, 'action'])->where('id', '[0-9]+')->where('action', '[a-zA-Z0-9]+')->name('account.action');

    Route::get('account/{id}/reset-password', [AccountController::class, 'reset_password'])->where('id', '[0-9]+')->name('account.reset_password');
    Route::post('account/{id}/reset-password', [AccountController::class, 'reset_password_action'])->where('id', '[0-9]+');

    // Posts
    Route::resource('post-types', PostTypeController::class)->parameters(['post-types' => 'id']);
    Route::resource('taxonomies', TaxonomyController::class)->parameters(['taxonomies' => 'id']);
    Route::resource('post-type-taxonomies', PostTypeTaxonomiesController::class)->parameters(['post-type-taxonomies' => 'id']);

    Route::get('posts/comments', [PostController::class, 'comments'])->name('posts.comments');
    Route::put('posts/comments/{id}', [PostController::class, 'update_comment'])->name('posts.comments.update')->where('id', '[0-9]+');
    Route::delete('posts/comments/{id}', [PostController::class, 'destroy_comment'])->name('posts.comments.destroy')->where('id', '[0-9]+');

    Route::get('posts/reactions', [PostController::class, 'reactions'])->name('posts.reactions');
    Route::delete('posts/reactions/delete', [PostController::class, 'destroy_reaction'])->name('posts.reactions.destroy');

    Route::get('posts/config', [PostController::class, 'config'])->name('posts.config');
    Route::post('posts/config', [PostController::class, 'update_config']);

    Route::resource('posts', PostController::class)->parameters(['posts' => 'id']);
    Route::post('posts/{id}/sortable', [PostController::class, 'sortable'])->name('posts.sortable')->where('id', '[0-9]+');
    Route::get('posts/{id}/content', [PostController::class, 'content'])->name('posts.content')->where('id', '[0-9]+');
    Route::post('posts/{id}/content', [PostController::class, 'update_content'])->name('posts.content.new')->where('id', '[0-9]+');
    Route::delete('posts/{id}/content/delete/{block_id}', [PostController::class, 'delete_content'])->name('posts.content.delete')->where('id', '[0-9]+')->where('block_id', '[0-9]+');

    Route::get('posts/{id}/delete-main-image', [PostController::class, 'delete_main_image'])->name('posts.delete_main_image')->where('id', '[0-9]+');
    Route::get('posts/{id}/custom-fieldsf', [PostController::class, 'custom_fields'])->name('post.cf');

    // Plugins
    Route::get('plugins',  [PluginController::class, 'index'])->name('plugins');
    Route::get('plugins/install/{plugin}', [PluginController::class, 'install'])->name('plugins.install')->where('plugin', '[0-9a-zA-Z-/]+');


    // Themes
    Route::get('themes/set-default',  [ThemeController::class, 'set_default'])->name('themes.set_default');
    Route::resource('themes', ThemeController::class)->parameters(['themes' => 'slug']);

    // Templates
    Route::resource('templates', TemplateController::class)->parameters(['templates' => 'slug']);

    Route::get('template/logo', [TemplateController::class, 'logo'])->name('template.logo');
    Route::post('template/logo', [TemplateController::class, 'update_logo']);

    Route::get('template/custom-code', [TemplateController::class, 'custom_code'])->name('template.custom_code');
    Route::post('template/custom-code',  [TemplateController::class, 'update_custom_code']);
    Route::get('template/custom-code/delete',  [TemplateController::class, 'custom_code_delete_file'])->name('template.custom_code.delete_file');

    Route::get('template/menu/dropdown', [TemplateMenuController::class, 'index_dropdowns'])->name('template.menu.dropdown');
    Route::post('template/menu/dropdown', [TemplateMenuController::class, 'store_dropdown']);
    Route::put('template/menu/dropdown', [TemplateMenuController::class, 'update_dropdown']);
    Route::delete('template/menu/dropdown', [TemplateMenuController::class, 'destroy_dropdown']);
    Route::post('template/menu/sortable-dropdowns/{parent_link_id}', [TemplateMenuController::class, 'sortable_dropdowns'])->name('template.menu.sortable_dropdowns')->where('parent_link_id', '[0-9]+');
    Route::resource('template/menu', TemplateMenuController::class)->names(['index' => 'template.menu', 'create' => 'template.menu.create', 'show' => 'template.menu.show'])->parameters(['menu' => 'id']);
    Route::post('template/menu/sortable', [TemplateMenuController::class, 'sortable'])->name('template.menu.sortable');


    // Template Builder
    Route::prefix('template-builder')->name('template-builder.')->group(function () {
        Route::get('/', [TemplateBuilderController::class, 'index'])->name('index')->where(['id' => '[0-9]+']);

        // Template Builder - Layouts
        Route::resource('template-builder/layouts', TemplateLayoutController::class)->names(['index' => 'layouts', 'create' => 'layouts.create', 'show' => 'layouts.show'])->parameters(['layouts' => 'id']);
        Route::post('template-builder/layouts/{id}/sortable', [TemplateLayoutController::class, 'sortable'])->name('layouts.sortable')->where('id', '[0-9]+');
        Route::post('template-builder/layouts/{id}/update', [TemplateLayoutController::class, 'update'])->name('layouts.update')->where('id', '[0-9]+');
        //Route::delete('template-builder/layouts/delete/{block_id}', [TemplateLayoutController::class, 'delete_content'])->name('layouts.content.delete')->where('block_id', '[0-9]+');
        Route::get('template-builder/layouts/{id}/content', [TemplateLayoutController::class, 'content'])->name('layouts.content')->where(['id' => '[0-9]+']);
        Route::post('template-builder/layouts/{id}/content', [TemplateLayoutController::class, 'update_content'])->name('layouts.content.new')->where('id', '[0-9]+');
        Route::delete('template-builder/layouts/{id}/content/delete/{block_id}', [TemplateLayoutController::class, 'delete_content'])->name('layouts.content.delete')->where('id', '[0-9]+')->where('block_id', '[0-9]+');
        Route::get('template-builder/layouts/block/{id}', [TemplateLayoutController::class, 'block'])->name('layouts.block')->where('id', '[0-9]+');
        Route::put('template-builder/layouts/block/{id}', [TemplateLayoutController::class, 'block_update'])->where('id', '[0-9]+');

        // Template Builder - Styles
        Route::get('template-builder/styles', [TemplateStyleController::class, 'index'])->name('styles');
        Route::post('template-builder/styles', [TemplateStyleController::class, 'store_custom']);
        Route::get('template-builder/styles/{style}', [TemplateStyleController::class, 'show'])->name('template.styles.show')->where('style', '[0-9a-zA-Z_-]+');
        Route::put('template-builder/styles/{style}', [TemplateStyleController::class, 'update'])->where('style', '[0-9a-zA-Z_-]+');
        Route::get('template-builder/custom-styles/{id}', [TemplateStyleController::class, 'show_custom'])->name('custom_styles.show')->where('id', '[0-9]+');
        Route::put('template-builder/custom-styles/{id}', [TemplateStyleController::class, 'update_custom'])->where('id', '[0-9a-zA-Z_-]+');
        Route::delete('template-builder/custom-styles/{id}', [TemplateStyleController::class, 'destroy_custom'])->where('id', '[0-9]+');

        // Template Builder - Buttons
        Route::resource('template/buttons', TemplateButtonController::class)->names(['index' => 'template.buttons', 'create' => 'template.buttons.create', 'show' => 'template.buttons.show'])->parameters(['buttons' => 'id']);
    });

    // Template footer content routes
    Route::get('template/footer', [TemplateFooterController::class, 'index'])->name('template.footer');
    Route::put('template/footer', [TemplateFooterController::class, 'update']);

    Route::get('template/footer/{footer}/content', [TemplateFooterController::class, 'content'])->name('template.footer.content')->where(['footer' => '[a-z0-9_-]+']);

    Route::post('template/footer/{footer}/content', [TemplateFooterController::class, 'update_content'])->where(['footer' => '[a-z0-9_-]+']);

    Route::post('template/footer/{footer}/{col}/sortable', [TemplateFooterController::class, 'sortable'])->name('template.footer.sortable')->where('footer', '[a-z0-9_-]+')->where('col', '[0-9]+');
    Route::delete('template/footer/delete/{block_id}', [TemplateFooterController::class, 'delete_content'])->name('template.footer.content.delete')->where('block_id', '[0-9]+');
    Route::get('template/footer/block/{id}', [TemplateFooterController::class, 'block'])->name('template.footer.block')->where('id', '[0-9]+');
    Route::put('template/footer/block/{id}', [TemplateFooterController::class, 'block_update'])->where('id', '[0-9]+');

    //  admin role only
    Route::middleware(LoggedIsAdminMiddleware::class)->group(function () {
        // Languages
        Route::resource('languages', LangController::class)->parameters(['languages' => 'id']);

        // Config
        Route::get('config/{tab}', [ConfigController::class, 'index'])->name('config')->where(['tab' => '[a-zA-Z0-9_-]+']);
        Route::post('config/{tab}', [ConfigController::class, 'update'])->where(['tab' => '[a-zA-Z0-9_-]+']);

        // Recycle Bin
        Route::get('recycle-bin', [RecycleBinController::class, 'index'])->name('recycle_bin');
        Route::get('recycle-bin/empty/{module}', [RecycleBinController::class, 'empty'])->name('recycle_bin.empty')->where('module', '[a-zA-Z0-9]+');
        Route::post('recycle-bin/multiple-action/{module}', [RecycleBinController::class, 'multiple_action'])->name('recycle_bin.multiple_action')->where('module', '[a-zA-Z0-9]+');
        Route::get('recycle-bin/single-action/{module}/{id}', [RecycleBinController::class, 'single_action'])->name('recycle_bin.single_action')->where('module', '[a-zA-Z0-9]+')->where('id', '[0-9]+');
        Route::get('recycle-bin/{module}', [RecycleBinController::class, 'module'])->name('recycle_bin.module')->where('module', '[a-zA-Z0-9]+');
    });

    // Blocks routes
    Route::resource('blocks', BlockController::class)->parameters(['blocks' => 'id']);

    // Other routes
    Route::get('ajax/{source}', [AjaxController::class, 'fetch'])->name('ajax')->where('source', '[a-z0-9_-]+');
});
